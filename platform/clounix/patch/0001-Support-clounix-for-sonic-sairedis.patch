From 311f23e5c31116b58035b65135062bb3e2815d2a Mon Sep 17 00:00:00 2001
From: "Zhou,Junde" <zhoujd@clounix.com>
Date: Wed, 21 May 2025 15:00:58 +0800
Subject: [PATCH] Support clounix for sonic sairedis

---
 configure.ac                       | 1 +
 syncd/Makefile.am                  | 5 +++++
 syncd/scripts/syncd_init_common.sh | 7 +++++++
 3 files changed, 13 insertions(+)

diff --git a/configure.ac b/configure.ac
index 5e017196..fcfe165d 100644
--- a/configure.ac
+++ b/configure.ac
@@ -17,6 +17,7 @@ AX_ADD_AM_MACRO_STATIC([])
 
 AM_CONDITIONAL(SONIC_ASIC_PLATFORM_BAREFOOT,   test x$CONFIGURED_PLATFORM = xbarefoot)
 AM_CONDITIONAL(SONIC_ASIC_PLATFORM_BROADCOM,   test x$CONFIGURED_PLATFORM = xbroadcom)
+AM_CONDITIONAL(SONIC_ASIC_PLATFORM_CLOUNIX,    test x$CONFIGURED_PLATFORM = xclounix)
 
 AC_ARG_ENABLE(debug,
 [  --enable-debug          turn on debugging],
diff --git a/syncd/Makefile.am b/syncd/Makefile.am
index 02ab83ca..7266b858 100644
--- a/syncd/Makefile.am
+++ b/syncd/Makefile.am
@@ -76,6 +76,11 @@ if SONIC_ASIC_PLATFORM_BROADCOM
 libSyncd_a_CXXFLAGS += -DMDIO_ACCESS_USE_NPU
 endif
 
+if SONIC_ASIC_PLATFORM_CLOUNIX
+syncd_CPPFLAGS += -DSAI_SUPPORT_UNINIT_DATA_PLANE_ON_REMOVAL
+libSyncd_a_CPPFLAGS += -DSAI_SUPPORT_UNINIT_DATA_PLANE_ON_REMOVAL
+endif
+
 libSyncdRequestShutdown_a_SOURCES = \
 									RequestShutdown.cpp \
 									RequestShutdownCommandLineOptions.cpp \
diff --git a/syncd/scripts/syncd_init_common.sh b/syncd/scripts/syncd_init_common.sh
index 70b91eb4..9a51d040 100644
--- a/syncd/scripts/syncd_init_common.sh
+++ b/syncd/scripts/syncd_init_common.sh
@@ -298,6 +298,11 @@ config_syncd_soda()
     CMD_ARGS+=" -l -p $HWSKU_DIR/sai.profile"
 }
 
+config_syncd_clounix()
+{
+    CMD_ARGS+=" -p $HWSKU_DIR/sai.profile"
+}
+
 config_syncd_innovium()
 {
     CMD_ARGS+=" -p $HWSKU_DIR/sai.profile"
@@ -330,6 +335,8 @@ config_syncd()
         config_syncd_nephos
     elif [ "$SONIC_ASIC_TYPE" == "vs" ]; then
         config_syncd_vs
+    elif [ "$SONIC_ASIC_TYPE" == "clounix" ]; then
+        config_syncd_clounix
     elif [ "$SONIC_ASIC_TYPE" == "innovium" ]; then
         config_syncd_innovium
     elif [ "$SONIC_ASIC_TYPE" == "soda" ]; then
-- 
2.25.1

