From b9bf7a8115dfe0e43168730a6b02c6ed69ec4df3 Mon Sep 17 00:00:00 2001
From: Jianyue Wu <jianyuew@nvidia.com>
Date: Thu, 9 Oct 2025 17:08:09 +0800
Subject: [PATCH] Disable hw-management-sync.service

Remove service dependency and comment out enable/start and mask
configurations in rules to prevent hw-management-sync starting.

Signed-off-by: Jianyue Wu <jianyuew@nvidia.com>
---
 debian/hw-management.hw-management.service | 1 -
 debian/rules                               | 8 ++++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/debian/hw-management.hw-management.service b/debian/hw-management.hw-management.service
index 8a5c0423..639bd3cd 100755
--- a/debian/hw-management.hw-management.service
+++ b/debian/hw-management.hw-management.service
@@ -1,7 +1,6 @@
 [Unit]
 Description=Chassis HW management service of Mellanox systems
 Documentation=man:hw-management.service(8)
-Wants=hw-management-sync.service
 Before=determine-reboot-cause.service system-health.service watchdog-control.service
 
 [Service]
diff --git a/debian/rules b/debian/rules
index f1cbd449..932ab8df 100755
--- a/debian/rules
+++ b/debian/rules
@@ -59,14 +59,18 @@ override_dh_installinit:
 override_dh_systemd_enable:
 	dh_systemd_enable --name=hw-management
 	dh_systemd_enable --name=hw-management-tc
-	dh_systemd_enable --name=hw-management-sync
+	# dh_systemd_enable --name=hw-management-sync (disabled - service is masked)
+	# Mask hw-management-sync service by creating symlink to /dev/null in /etc/systemd/system
+	# This overrides the service file and prevents service from starting (can be unmasked if needed)
+	dh_installdirs -p$(pname) etc/systemd/system
+	ln -sf /dev/null debian/$(pname)/etc/systemd/system/hw-management-sync.service
 	dh_systemd_enable --name=hw-management-sysfs-monitor
 	dh_systemd_enable --name=hw-management-fast-sysfs-monitor
 
 override_dh_systemd_start:
 	dh_systemd_start --name=hw-management
 	dh_systemd_start --name=hw-management-tc
-	dh_systemd_start --name=hw-management-sync
+	#dh_systemd_start --name=hw-management-sync
 	dh_systemd_start --name=hw-management-sysfs-monitor
 	dh_systemd_start --name=hw-management-fast-sysfs-monitor
 
-- 
2.43.0

