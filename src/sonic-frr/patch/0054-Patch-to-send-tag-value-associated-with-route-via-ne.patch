From 1a8b3715a88aeaa4bda1ac445aa4992a14f33f31 Mon Sep 17 00:00:00 2001
From: Abhishek Dosi <abdosi@microsoft.com>
Date: Fri, 8 Nov 2024 02:19:37 +0000
Subject: [PATCH] Patch to send tag value associated with route via netlink in
 RTA_PRIORITY field.

Signed-off-by: Abhishek Dosi <abdosi@microsoft.com>
---
 zebra/rt_netlink.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/zebra/rt_netlink.c b/zebra/rt_netlink.c
index 3f51894be..65f598aad 100644
--- a/zebra/rt_netlink.c
+++ b/zebra/rt_netlink.c
@@ -2113,9 +2113,17 @@ ssize_t netlink_route_multipath_msg_encode(int cmd,
 	 * path(s)
 	 * by the routing protocol and for communicating with protocol peers.
 	 */
+
+	/* Patch to send tag value as route attribute using RTA_PRIORITY
+	 * which can be used as metadata/attribute to take application specific
+	 * action. As seen in above comment this field is not use anyways and can be
+	 * use by fpmsyncd */
 	if (!nl_attr_put32(&req->n, datalen, RTA_PRIORITY,
-			   ROUTE_INSTALLATION_METRIC))
+		           cmd == RTM_DELROUTE ? dplane_ctx_get_old_tag(ctx) :
+				                 dplane_ctx_get_tag(ctx)))
+	{
 		return 0;
+	}
 
 #if defined(SUPPORT_REALMS)
 	if (cmd == RTM_DELROUTE)
-- 
2.25.1

