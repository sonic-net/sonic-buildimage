apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: networkdevices.sonic.io
spec:
  group: sonic.io
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required: ["os"]
            properties:
              os:
                type: object
                required: ["desiredVersion", "imageURL"]
                properties:
                  desiredVersion:
                    type: string
                    description: "Target SONiC OS version to download"
                  imageURL:
                    type: string
                    format: uri
                    description: "HTTP/HTTPS URL to download SONiC binary image from"
                  checksum:
                    type: object
                    description: "Checksum for download verification"
                    properties:
                      md5:
                        type: string
                        pattern: '^[a-f0-9]{32}$'
                  downloadPath:
                    type: string
                    default: "/tmp/sonic-image.bin"
                    description: "Local path to save downloaded SONiC binary"
          status:
            type: object
            properties:
              downloadStatus:
                type: object
                properties:
                  phase:
                    type: string
                    enum: ["Pending", "Downloading", "Succeeded", "Failed"]
                  message:
                    type: string
                  lastAttemptTime:
                    type: string
                    format: date-time
                  downloadedVersion:
                    type: string
                    description: "Version of SONiC binary currently downloaded"
                  downloadedChecksum:
                    type: string
                    description: "MD5 of currently downloaded file"
    subresources:
      status: {}
    additionalPrinterColumns:
    - name: Desired Version
      type: string
      jsonPath: .spec.os.desiredVersion
    - name: Download Status
      type: string
      jsonPath: .status.downloadStatus.phase
    - name: Downloaded Version
      type: string
      jsonPath: .status.downloadStatus.downloadedVersion
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
  scope: Namespaced
  names:
    plural: networkdevices
    singular: networkdevice
    kind: NetworkDevice
    shortNames:
    - netdev
